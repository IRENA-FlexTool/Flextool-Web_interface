import{q as T,o as b,g as B,s as N,_ as F,r as s,c as C,u as z,f as H,m as G,a as r,b as I,w as t,d as n,e as h,t as J,h as K,F as O,y as Q,i as W,n as X}from"./assets/_plugin-vue_export-helper-9d6dd65a.js";import{P as Y,a as Z,k as $,g as ee,m as te,j as ne}from"./assets/communication-4bfe7b70.js";import{F as k}from"./assets/Fetchable-5d7f263a.js";import{e as M,a as p,f as A}from"./assets/executions-e9893525.js";const oe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 448 512"},re=N("path",{d:"M424.4 214.7L72.4 6.6C43.8-10.3 0 6.1 0 47.9V464c0 37.5 40.7 60.1 72.4 41.3l352-208c31.4-18.5 31.5-64.1 0-82.6z",fill:"currentColor"},null,-1),ae=[re],le=T({name:"Play",render:function(c,o){return b(),B("svg",oe,ae)}}),se={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 448 512"},ce=N("path",{d:"M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48z",fill:"currentColor"},null,-1),ue=[ce],ie=T({name:"Stop",render:function(c,o){return b(),B("svg",se,ue)}}),de={props:{indexUrl:{type:String,required:!0},editUrl:{type:String,required:!0},projectUrl:{type:String,required:!0},projectName:{type:String,required:!0},projectId:{type:Number,required:!0},runUrl:{type:String,required:!0},resultsUrl:{type:String,required:!0},modelUrl:{type:String,required:!0},executionsUrl:{type:String,required:!0},scenariosUrl:{type:String,required:!0},logoutUrl:{type:String,required:!0},logoUrl:{type:String,required:!0}},components:{fetchable:k,page:Y,"page-path":Z,play:le,"stop-icon":ie},setup(a){const c=s([]),o=s([]),e=s([]),y=s(k.state.loading),j=s(""),_=s(p.yetToStart),u=s(!1),f=s(!1),v=s(null),x=C(()=>u.value||o.value.length===0),E=C(()=>!u.value||f.value),d=s("default"),S=C(function(){return c.value.length===0?(d.value="error","No scenarios available. Please create some in the Scenario editor."):_.value===p.finished?(d.value="success","Run finished successfully."):_.value===p.aborted?(d.value="default","Run aborted."):_.value===p.error?(d.value="error","Error. Check run log."):(d.value="default","")}),i=z(),U=function(){u.value=!1,f.value=!1};return H(function(){const g=$("scenarios?",a.projectId,a.modelUrl).then(function(l){return l.scenarios});ee(a.projectId,a.executionsUrl).then(async function(l){if(l.type!==M.solve&&l.status===p.running)switch(l.type){case M.importExcel:i.warning("Server is busy importing an Excel file.");break;default:i.error("Server is busy.")}else l.type===M.solve&&l.status===p.running&&(u.value=!0,A(a.projectId,a.executionsUrl,e,_,i,U));(await g).forEach(m=>c.value.push(m.scenario_name)),l.scenarios!==void 0&&l.scenarios.forEach(function(m){c.value.find(q=>q===m)!==void 0&&o.value.push(m)}),y.value=k.state.ready}).catch(function(l){j.value=l.message,y.value=k.state.error})}),G(e,function(){v.value!==null&&Q(()=>v.value.scrollTo({top:e.value.length*1e3,slient:!0}))}),{availableScenarios:c,selectedScenarios:o,logLines:e,statusMessageType:d,statusMessage:S,state:y,errorMessage:j,isExecuting:u,isAborting:f,logInstance:v,isPlayButtonDisabled:x,isAbortButtonDisabled:E,execute:function(){u.value=!0,e.value.length=0,te(a.projectId,a.executionsUrl,o.value).then(function(){A(a.projectId,a.executionsUrl,e,_,i,U)}).catch(function(g){i.error(g.message)})},abort:function(){f.value=!0,ne(a.projectId,a.executionsUrl).catch(function(g){i.error(g.message)})}}}};function ge(a,c,o,e,y,j){const _=r("page-path"),u=r("n-text"),f=r("n-a"),v=r("n-checkbox"),x=r("n-space"),E=r("n-checkbox-group"),d=r("play"),S=r("n-icon"),i=r("n-button"),U=r("stop-icon"),g=r("n-grid-item"),l=r("n-h1"),D=r("n-log"),m=r("n-card"),q=r("n-grid"),R=r("fetchable"),L=r("page");return b(),I(L,{name:"Run","index-url":o.indexUrl,"project-url":o.projectUrl,"edit-url":o.editUrl,"run-url":o.runUrl,"results-url":o.resultsUrl,"logout-url":o.logoutUrl,"logo-url":o.logoUrl},{header:t(()=>[n(_,{path:[{name:"Projects",url:o.indexUrl},{name:o.projectName,url:o.projectUrl}],"leaf-name":"Run"},null,8,["path"])]),default:t(()=>[n(R,{state:e.state,"error-message":e.errorMessage},{default:t(()=>[n(q,{cols:3},{default:t(()=>[n(g,null,{default:t(()=>[n(x,{vertical:""},{default:t(()=>[n(u,{type:e.statusMessageType},{default:t(()=>[h(J(e.statusMessage),1)]),_:1},8,["type"]),n(f,{href:o.scenariosUrl},{default:t(()=>[h("Scenario editor")]),_:1},8,["href"]),n(u,null,{default:t(()=>[h("Select scenarios to run:")]),_:1}),n(E,{value:e.selectedScenarios,"onUpdate:value":c[0]||(c[0]=w=>e.selectedScenarios=w),disabled:e.isExecuting},{default:t(()=>[n(x,{vertical:""},{default:t(()=>[(b(!0),B(O,null,K(e.availableScenarios,(w,V)=>(b(),I(v,{value:w,label:w,key:V},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value","disabled"]),n(x,null,{default:t(()=>[n(i,{onClick:e.execute,disabled:e.isPlayButtonDisabled,loading:e.isExecuting},{icon:t(()=>[n(S,null,{default:t(()=>[n(d)]),_:1})]),default:t(()=>[h(" Run ")]),_:1},8,["onClick","disabled","loading"]),n(i,{onClick:e.abort,disabled:e.isAbortButtonDisabled,loading:e.isAborting},{icon:t(()=>[n(S,null,{default:t(()=>[n(U)]),_:1})]),default:t(()=>[h(" Abort ")]),_:1},8,["onClick","disabled","loading"])]),_:1})]),_:1})]),_:1}),n(g,{span:2},{default:t(()=>[n(l,null,{default:t(()=>[h("Run log")]),_:1}),n(m,{size:"small"},{default:t(()=>[n(D,{lines:e.logLines,rows:20,loading:e.isExecuting,ref:"logInstance"},null,8,["lines","loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["state","error-message"])]),_:1},8,["index-url","project-url","edit-url","run-url","results-url","logout-url","logo-url"])}const _e=F(de,[["render",ge]]),P=W({});P.use(X);P.component("run-app",_e);P.mount("#run-app");
